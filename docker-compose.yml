version: "3.8"

services:
    react-app:
        build:
            context: react_app
            dockerfile: Dockerfile
        working_dir: /app
        environment:
            - NODE_ENV=production
    api:
        build:
            context: api
            dockerfile: Dockerfile
        working_dir: /app
        volumes:
            - ${STREAMS_FOLDER}:/app/public/streams/
        environment:
            - NODE_ENV=production
    nginx:
        image: nginx:1.20.2-alpine
        ports: 
            - ${PORT}:80
        volumes:
            - ${STREAMS_FOLDER}:/app/static/streams:ro
            - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro 
        command: ["nginx", "-g", "daemon off;"]
        depends_on: 
            - api
            - react-app